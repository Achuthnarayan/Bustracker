<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Bus Operator Login - Bus Tracker</title>
  <link rel="stylesheet" href="style.css">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<div class="container">
  <h2>Bus Operator Login</h2>
  <p class="subtitle">Login to start your bus service</p>

  <form id="operatorLoginForm" onsubmit="return false;">
    <input type="text" id="operatorId" placeholder="Operator ID" autocomplete="username" required>
    <input type="password" id="password" placeholder="Password" autocomplete="current-password" required>

    <button type="submit" id="loginBtn" onclick="operatorLogin()">Login as Operator</button>
    <button type="button" class="btn-secondary" onclick="goToStudentLogin()">Student Login</button>
  </form>
</div>

<div id="popup" class="popup"></div>

<script src="config.js"></script>
<script src="js/validation.js"></script>
<script src="js/session.js"></script>
<script src="js/api.js"></script>
<script src="js/ui.js"></script>

<script>
// Check if already logged in as operator
if (SessionManager.isAuthenticated() && SessionManager.getUser()?.role === 'operator') {
  window.location.href = 'operator-dashboard.html';
}

async function operatorLogin() {
  UI.clearAllErrors();
  
  const operatorId = document.getElementById('operatorId').value;
  const password = document.getElementById('password').value;
  
  if (!operatorId || !password) {
    UI.showError('Please enter both Operator ID and Password');
    return;
  }
  
  UI.showLoading('loginBtn');
  
  try {
    const response = await API.operatorLogin(operatorId, password);
    
    SessionManager.setToken(response.token);
    SessionManager.setUser(response.user);
    
    UI.showSuccess('Login Successful!');
    setTimeout(() => {
      window.location.href = 'operator-dashboard.html';
    }, 1000);
    
  } catch (error) {
    UI.hideLoading('loginBtn', 'Login as Operator');
    UI.showError(error.message || 'Login failed. Please try again.');
  }
}

function goToStudentLogin() {
  window.location.href = 'index.html';
}

// Allow Enter key to submit
document.getElementById('operatorLoginForm').addEventListener('keypress', function(e) {
  if (e.key === 'Enter') {
    operatorLogin();
  }
});
</script>

</body>
</html>
